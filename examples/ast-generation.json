{"1":["# AST Generation\n\n<br>\n<center>\n<table>\n<tr>\n<td>\n<center>\n<b>Polyhedral Model</b>\n</center>\n</td>\n<td>\n</td>\n<td>\n<center>\n<b>Imperative Program</b>\n</center>\n</tr>\n\n<tr>\n<td>\n\n<b>Iteration Domain</b>  <br>\n\\\\( \\\\{ T[i,j] \\mid 0 < i \\le j < 10; S[i,0] \\mid 0 < i \\le 20 \\\\}\\\\)   <br>\n<br>\n\n<b>Schedule</b>  <br>\n\\\\( \\\\{ T[i,j] \\to [i,j]; S[i,0] \\\\to [i,j] \\\\}\\\\)   \n\n</td>\n<td>\n&nbsp; &nbsp; &nbsp;  <b>\\\\( \\Huge \\\\to \\\\) </b>&nbsp; &nbsp; &nbsp; \n</td>\n<td>\n<center>\n<br>\n```c\nconst int N = 10;\ndouble X[N], Y[N], Z[2*N];\n\nfor (int i = 0; i <= 2*N; ++i)\nS:  Z[i] = 0.;\nfor (int i = 1; i <= N; ++i)\n    for (int j = i; j <= N; ++j)\nT:      Z[i + j] += A[i] * B[j];\n```\n</td>\n</tr>\n</table>\n</center>\n\n<br>\n**Polyhedral AST generation is more than scanning polyhedra**  \nTobias Grosser, Sven Verdoolaege, Albert Cohen  \nACM Transations on Programming Languages and Systems (TOPLAS), 37(4), July 2015\n\n## Generate an AST\n### Define a simple polyhedral program description","<a onclick='pt_editMarkdown(this)' tabindex='-1' class=\"pt-markdown-link\">[Markdown]</a><h1 id=\"astgeneration\">AST Generation</h1>\n<p><br>\n<center></p>\n<table>\n<tr>\n<td>\n<center>\n<b>Polyhedral Model</b>\n</center>\n</td>\n<td>\n</td>\n<td>\n<center>\n<b>Imperative Program</b>\n</center>\n</tr>\n\n<tr>\n<td>\n\n<b>Iteration Domain</b>  <br>\n\\( \\{ T[i,j] \\mid 0 < i \\le j < 10; S[i,0] \\mid 0 < i \\le 20 \\}\\)   <br>\n<br>\n\n<b>Schedule</b>  <br>\n\\( \\{ T[i,j] \to [i,j]; S[i,0] \\to [i,j] \\}\\)   \n\n</td>\n<td>\n&nbsp; &nbsp; &nbsp;  <b>\\( \\Huge \\to \\) </b>&nbsp; &nbsp; &nbsp; \n</td>\n<td>\n<center>\n<br><pre><code class=\"c language-c\">const int N = 10;\ndouble X[N], Y[N], Z[2*N];\n\nfor (int i = 0; i &lt;= 2*N; ++i)\nS:  Z[i] = 0.;\nfor (int i = 1; i &lt;= N; ++i)\n    for (int j = i; j &lt;= N; ++j)\nT:      Z[i + j] += A[i] * B[j];\n</code></pre>\n</td>\n</tr>\n</table>\n<p></center></p>\n<p><br>\n<strong>Polyhedral AST generation is more than scanning polyhedra</strong><br />\nTobias Grosser, Sven Verdoolaege, Albert Cohen<br />\nACM Transations on Programming Languages and Systems (TOPLAS), 37(4), July 2015</p>\n<h2 id=\"generateanast\">Generate an AST</h2>\n<h3 id=\"defineasimplepolyhedralprogramdescription\">Define a simple polyhedral program description</h3>\n","markdown"],"2":["context = isl.set(\"{ : }\")\ndomain = isl.set(\"{ S[t,i] : 1 <=t<=5 and 1<=i<=10 }\")\nschedule = isl.map(\"{ S[t,i] -> T[t+1,i+t+10] }\")\n\nschedule_domain = schedule.intersect_domain(domain)\nplot([domain, schedule_domain])","<table class='table table-striped'><thead><tr><th><div class='graphics' id='graphics_361244559629'><img src='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7' onload='plotUnionSetCombined(\"#graphics_361244559629\",[{\"name\": \"S\", \"points\": [[1, 1], [1, 2], [1, 3], [1, 4], [1, 5], [1, 6], [1, 7], [1, 8], [1, 9], [1, 10], [2, 1], [2, 2], [2, 3], [2, 4], [2, 5], [2, 6], [2, 7], [2, 8], [2, 9], [2, 10], [3, 1], [3, 2], [3, 3], [3, 4], [3, 5], [3, 6], [3, 7], [3, 8], [3, 9], [3, 10], [4, 1], [4, 2], [4, 3], [4, 4], [4, 5], [4, 6], [4, 7], [4, 8], [4, 9], [4, 10], [5, 1], [5, 2], [5, 3], [5, 4], [5, 5], [5, 6], [5, 7], [5, 8], [5, 9], [5, 10]], \"tiles\": [], \"id\": 5.378973105134475}],\"#graphics_361244559629\")'></div></th><th><div class='graphics' id='graphics_124990982556'><img src='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7' onload='plotUnionMapClosed(\"#graphics_124990982556\",[{\"from\": \"S\", \"to\": \"T\", \"points\": [[1, 1, 2, 12], [1, 2, 2, 13], [1, 3, 2, 14], [1, 4, 2, 15], [1, 5, 2, 16], [1, 6, 2, 17], [1, 7, 2, 18], [1, 8, 2, 19], [1, 9, 2, 20], [1, 10, 2, 21], [2, 1, 3, 13], [2, 2, 3, 14], [2, 3, 3, 15], [2, 4, 3, 16], [2, 5, 3, 17], [2, 6, 3, 18], [2, 7, 3, 19], [2, 8, 3, 20], [2, 9, 3, 21], [2, 10, 3, 22], [3, 1, 4, 14], [3, 2, 4, 15], [3, 3, 4, 16], [3, 4, 4, 17], [3, 5, 4, 18], [3, 6, 4, 19], [3, 7, 4, 20], [3, 8, 4, 21], [3, 9, 4, 22], [3, 10, 4, 23], [4, 1, 5, 15], [4, 2, 5, 16], [4, 3, 5, 17], [4, 4, 5, 18], [4, 5, 5, 19], [4, 6, 5, 20], [4, 7, 5, 21], [4, 8, 5, 22], [4, 9, 5, 23], [4, 10, 5, 24], [5, 1, 6, 16], [5, 2, 6, 17], [5, 3, 6, 18], [5, 4, 6, 19], [5, 5, 6, 20], [5, 6, 6, 21], [5, 7, 6, 22], [5, 8, 6, 23], [5, 9, 6, 24], [5, 10, 6, 25]], \"tiles\": [], \"id\": {\"S\": 5.378973105134475, \"T\": 4.661016949152542}}],\"#graphics_124990982556\")'></div></th></tr></thead></table>\n","python"],"3":["## Translate polyhedral program description to an AST\n\nThe AST that is generated is an actual AST. It can be walked and inspected using tree operations.","<a onclick='pt_editMarkdown(this)' tabindex='-1' class=\"pt-markdown-link\">[Markdown]</a><h2 id=\"translatepolyhedralprogramdescriptiontoanast\">Translate polyhedral program description to an AST</h2>\n<p>The AST that is generated is an actual AST. It can be walked and inspected using tree operations.</p>\n","markdown"],"4":["build = isl.ast_build.from_context(context) \nast = build.node_from_schedule_map(schedule.intersect_domain(domain))\nprint_code(ast)","<pre class='code'><code class=\"cpp hljs\">for (int c0 = 2; c0 <= 6; c0 += 1)\n  for (int c1 = c0 + 10; c1 <= c0 + 19; c1 += 1)\n    S(c0 - 1, -c0 + c1 - 9);\n</code></pre>\n","python"],"5":["## AST Generation for Constraint Sets\n\nWhen optimizing programs some transformations are often only valid\nunder certain conditions. To still apply such transformations it is\ncommon to perform code versioning. The optimized version of the code is\nexecuted if the conditions hold, an unoptimized version\nof the code is executed otherwise.\n\nA simple example could be:\n    \n```\nvoid foo(long n, A[][100]) {\n  for (i = 0; i < n; i++)\n    for (j = 0; j < n; j++)\n      A[i][j] += i+j;\n}\n```\nThis code only has simple dependences if j is smaller than 100. This\nmeans n < 100. Hence we probably want to generate the following code:\n\n```    \nvoid foo(long n, A[][100]) {\n  if (n < 100)\n    // optimized code\n  else\n    // otherwise\n}\n```\nThe isl AST generator allows for the generation of arbitrary\nboolean conditions from a constraint set described by an isl set.","<a onclick='pt_editMarkdown(this)' tabindex='-1' class=\"pt-markdown-link\">[Markdown]</a><h2 id=\"astgenerationforconstraintsets\">AST Generation for Constraint Sets</h2>\n<p>When optimizing programs some transformations are often only valid\nunder certain conditions. To still apply such transformations it is\ncommon to perform code versioning. The optimized version of the code is\nexecuted if the conditions hold, an unoptimized version\nof the code is executed otherwise.</p>\n<p>A simple example could be:</p>\n<pre><code>void foo(long n, A[][100]) {\n  for (i = 0; i &lt; n; i++)\n    for (j = 0; j &lt; n; j++)\n      A[i][j] += i+j;\n}\n</code></pre>\n<p>This code only has simple dependences if j is smaller than 100. This\nmeans n &lt; 100. Hence we probably want to generate the following code:</p>\n<pre><code class=\"     language-    \">void foo(long n, A[][100]) {\n  if (n &lt; 100)\n    // optimized code\n  else\n    // otherwise\n}\n</code></pre>\n<p>The isl AST generator allows for the generation of arbitrary\nboolean conditions from a constraint set described by an isl set.</p>\n","markdown"],"6":["## A simple constraint set","<a onclick='pt_editMarkdown(this)' tabindex='-1' class=\"pt-markdown-link\">[Markdown]</a><h2 id=\"asimpleconstraintset\">A simple constraint set</h2>\n","markdown"],"7":["condition = isl.set(\"[n] -> {: n < 100}\")\nexpr = build.expr_from(condition)\nprint(expr.to_C_str())","n <= 99\n","python"],"8":["## Recovery of modulo expressions\n","<a onclick='pt_editMarkdown(this)' tabindex='-1' class=\"pt-markdown-link\">[Markdown]</a><h2 id=\"recoveryofmoduloexpressions\">Recovery of modulo expressions</h2>\n","markdown"],"9":["condition = isl.set(\"[n, m] -> {: n % 100 = 2}\")\nexpr = build.expr_from(condition)\nprint(expr.to_C_str())","(n - 2) % 100 == 0\n","python"],"10":["## Verification of complex conditions","<a onclick='pt_editMarkdown(this)' tabindex='-1' class=\"pt-markdown-link\">[Markdown]</a><h2 id=\"verificationofcomplexconditions\">Verification of complex conditions</h2>\n","markdown"],"11":["condition = isl.set(\"[n, m] -> {: (n != 0 implies m = 5) or n + m = 42}\")\nexpr = build.expr_from(condition)\nprint(expr.to_C_str())","m == 5 || n == 0 || n + m == 42\n","python"],"12":["","",""]}